<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.css">
    <script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>
       
    <style type="text/css">
      * {
        color: #737c93;
      }
      
      .mixpanel-platform-body {
        background-color: #fff;
        padding: 0px;
      }
    
      .top {
        background-color: #e7ebf1;
        box-shadow: inset -2px 0px 4px 0px rgba(0,0,0,0.1);
        margin-bottom: 15px;
        font-size: 17px;
        padding: 21px;
      }
      
      .top {
        position: relative;
      }
      
      .top .controls {
        position: absolute;
        right: 26px;
        top: 15px;
      }
      
      .top .controls .unit-select, .top .controls input {
        display: inline-block;
        vertical-align: middle;
      }
      
      input[type="text"] {
        background-color: #F5F6F9;
        border-radius: 3px;
        border: 1px solid #BDC7D2;
        color: #747d94;
        display: block;
        font-family: "helvetica neue",helvetica;
        font-size: 16px;
        font-weight: bold;
        height: 29px;
        margin-right: 5px;
        text-align: center;
        width: 36px;
      }
      
      div.charts {
        margin: 20px;
      }
      
      div.chart {
        margin-top: 50px;
        position: relative;
      }
      
      div.header {
        font-size: 16px;
        font-weight: bold;
        margin-bottom: 10px;
      }
      
      div.header .title {
        display: inline-block;
      }
      
      div.title {
        font-size: 16px;
        font-weight: bold;
      }
      
      div.result {
        padding: 1em;
        border: 1px solid #eee;
        margin-bottom: 2em;
        overflow: auto;
      }
      
      /*-------------------------
      	Inline help tip
      --------------------------*/
      
      
      .help-tip {
      	display: inline-block;
      	position: relative;
      	text-align: center;
      	background-color: #627695;
      	border-radius: 50%;
      	margin-left: 4px;
      	width: 16px;
      	height: 16px;
      	font-size: 10px;
      	line-height: 16px;
      	cursor: default;
      }
      
      .help-tip:before {
      	content:'?';
      	font-weight: bold;
      	color:#fff;
      }
      
      .help-tip:hover p {
      	display:block;
      	transform-origin: 100% 0%;
      
      	-webkit-animation: fadeIn 0.3s ease-in-out;
      	animation: fadeIn 0.3s ease-in-out;
      
      }
      
      .help-tip p {
      	display: none;
      	text-align: left;
      	background-color: #1E2021;
      	padding: 20px;
      	width: 300px;
      	position: absolute;
      	border-radius: 3px;
      	box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.2);
      	left: 0px;
      	color: #FFF;
      	font-size: 13px;
      	line-height: 1.4;
      	z-index: 200000;
      }
      
      .help-tip p:before {
      	position: absolute;
      	content: '';
      	width:0;
      	height: 0;
      	border:6px solid transparent;
      	border-bottom-color:#1E2021;
      	left:10px;
      	top:-12px;
      }
      
      .help-tip p:after {
      	width:100%;
      	height:40px;
      	content:'';
      	position: absolute;
      	top:-40px;
      	left:0;
      }
      
      @-webkit-keyframes fadeIn {
      	0% { 
      		opacity:0; 
      		transform: scale(0.6);
      	}
      
      	100% {
      		opacity:100%;
      		transform: scale(1);
      	}
      }
      
      @keyframes fadeIn {
      	0% { opacity:0; }
      	100% { opacity:100%; }
      }
      
      
      /* bootstrap nav */
      a {
        color: #337ab7;
        text-decoration: none;
      }
      a:hover,
      a:focus {
        color: #23527c;
        text-decoration: underline;
      }
      a:focus {
        outline: thin dotted;
        outline: 5px auto -webkit-focus-ring-color;
        outline-offset: -2px;
      }

      .nav {
        margin-bottom: 0;
        padding-left: 16px;
        list-style: none;
      }
      .nav > li {
        position: relative;
        display: block;
      }
      .nav > li > a {
        position: relative;
        display: block;
        padding: 10px 15px;
      }
      .nav > li > a:hover,
      .nav > li > a:focus {
        text-decoration: none;
        background-color: #fcfcfc;
      }
      .nav > li.disabled > a {
        color: #777777;
      }
      .nav > li.disabled > a:hover,
      .nav > li.disabled > a:focus {
        color: #777777;
        text-decoration: none;
        background-color: transparent;
        cursor: not-allowed;
      }
      .nav .open > a,
      .nav .open > a:hover,
      .nav .open > a:focus {
        background-color: #eeeeee;
        border-color: #337ab7;
      }
      .nav .nav-divider {
        height: 1px;
        margin: 9px 0;
        overflow: hidden;
        background-color: #e5e5e5;
      }
      .nav > li > a > img {
        max-width: none;
      }
      .nav-tabs {
        border-bottom: 1px solid #DBE7EF;
      }
      .nav-tabs > li {
        float: left;
        margin-bottom: -1px;
      }
      .nav-tabs > li > a {
        font-size: 14px;
        margin-right: 2px;
        line-height: 1.42857143;
        border: 1px solid transparent;
        border-radius: 4px 4px 0 0;
      }
      .nav-tabs > li > a:hover {
        border-color: #DBE7EF;
      }
      .nav-tabs > li.active > a,
      .nav-tabs > li.active > a:hover,
      .nav-tabs > li.active > a:focus {
        color: #555555;
        background-color: #ffffff;
        border: 1px solid #DBE7EF;
        border-bottom-color: transparent;
        cursor: default;
      }
      .nav-tabs.nav-justified {
        width: 100%;
        border-bottom: 0;
      }
      .nav-tabs.nav-justified > li {
        float: none;
      }
      .nav-tabs.nav-justified > li > a {
        text-align: center;
        margin-bottom: 5px;
      }
      .nav-tabs.nav-justified > .dropdown .dropdown-menu {
        top: auto;
        left: auto;
      }
      @media (min-width: 768px) {
        .nav-tabs.nav-justified > li {
          display: table-cell;
          width: 1%;
        }
        .nav-tabs.nav-justified > li > a {
          margin-bottom: 0;
        }
      }
      .nav-tabs.nav-justified > li > a {
        margin-right: 0;
        border-radius: 4px;
      }
      .nav-tabs.nav-justified > .active > a,
      .nav-tabs.nav-justified > .active > a:hover,
      .nav-tabs.nav-justified > .active > a:focus {
        border: 1px solid #DBE7EF;
      }
      @media (min-width: 768px) {
        .nav-tabs.nav-justified > li > a {
          border-bottom: 1px solid #DBE7EF;
          border-radius: 4px 4px 0 0;
        }
        .nav-tabs.nav-justified > .active > a,
        .nav-tabs.nav-justified > .active > a:hover,
        .nav-tabs.nav-justified > .active > a:focus {
          border-bottom-color: #ffffff;
        }
      }
      .nav-pills > li {
        float: left;
      }
      .nav-pills > li > a {
        border-radius: 4px;
      }
      .nav-pills > li + li {
        margin-left: 2px;
      }
      .nav-pills > li.active > a,
      .nav-pills > li.active > a:hover,
      .nav-pills > li.active > a:focus {
        color: #ffffff;
        background-color: #337ab7;
      }
      .nav-stacked > li {
        float: none;
      }
      .nav-stacked > li + li {
        margin-top: 2px;
        margin-left: 0;
      }
      .nav-justified {
        width: 100%;
      }
      .nav-justified > li {
        float: none;
      }
      .nav-justified > li > a {
        text-align: center;
        margin-bottom: 5px;
      }
      .nav-justified > .dropdown .dropdown-menu {
        top: auto;
        left: auto;
      }
      @media (min-width: 768px) {
        .nav-justified > li {
          display: table-cell;
          width: 1%;
        }
        .nav-justified > li > a {
          margin-bottom: 0;
        }
      }
      .nav-tabs-justified {
        border-bottom: 0;
      }
      .nav-tabs-justified > li > a {
        margin-right: 0;
        border-radius: 4px;
      }
      .nav-tabs-justified > .active > a,
      .nav-tabs-justified > .active > a:hover,
      .nav-tabs-justified > .active > a:focus {
        border: 1px solid #DBE7EF;
      }
      @media (min-width: 768px) {
        .nav-tabs-justified > li > a {
          border-bottom: 1px solid #DBE7EF;
          border-radius: 4px 4px 0 0;
        }
        .nav-tabs-justified > .active > a,
        .nav-tabs-justified > .active > a:hover,
        .nav-tabs-justified > .active > a:focus {
          border-bottom-color: #ffffff;
        }
      }
      .tab-content > .tab-pane {
        display: none;
      }
      .tab-content > .active {
        display: block;
      }
      .nav-tabs .dropdown-menu {
        margin-top: -1px;
        border-top-right-radius: 0;
        border-top-left-radius: 0;
      }
      .clearfix:before,
      .clearfix:after,
      .nav:before,
      .nav:after {
        content: " ";
        display: table;
      }
      .clearfix:after,
      .nav:after {
        clear: both;
      }
    </style>
  </head>
  <body class="mixpanel-platform-body">
    <div class="top">
      <span>There are currently <span class="active-users-count"></span> users on Mixpanel</span>
      <div class="controls">
        <input type="text" class="intervals-input" value=24 />
        <div class="unit-select"></div>
      </div>
    </div>
    <div>
        <ul class="nav nav-tabs">
          <li role="presentation" data-section="general" class="active"><a href="#">General/Business</a></li>
          <li role="presentation" data-section="core"><a href="#">Core product</a></li>
          <li role="presentation" data-section="people"><a href="#">People/notifications</a></li>
          <li role="presentation" data-section="systems"><a href="#">Systems</a></li>
          <li role="presentation" data-section="sre"><a href="#">SRE</a></li>
        </ul>
    </div>
     
    <div class="charts section general">
      <div class="chart homepage-views">
        <div class="header">
          <div class="title">Unique homepage visits</div>
          <div class="help-tip">
      			<p class="tooltip">The number of unique people viewing the home page. Uses the "homepage new" event in the main mixpanel project.</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      
      <div class="chart new-users">
        <div class="header">
          <div class="title">New signups</div>
          <div class="help-tip">
      			<p class="tooltip">The number of "$signup" events excluding users with "@mixpanel.com" email addresses</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      
      <div class="chart new-integrations">
        <div class="header">
          <div class="title">New integrations</div>
          <div class="help-tip">
      			<p class="tooltip">The total count of new integrations using the "first integration date" property on user profiles where their "Current tally" is greater than 0.</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      
      <div class="chart real-integrations">
        <div class="header">
          <div class="title">Real integrations</div>
          <div class="help-tip">
      			<p class="tooltip">The total count of new integrations using the "first integration date" property on user profiles where their "Current tally" is greater than 100.</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      
      <div class="chart active-users">
        <div class="header">
          <div class="title">Active users</div>
          <div class="help-tip">
      			<p class="tooltip">Unique users who have viewed at least one report and currently have more than 500 tallies</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      <div class="chart plan-changes-count">
        <div class="header">
          <div class="title">Number of plan changes (monthly only)</div>
          <div class="help-tip">
      			<p class="tooltip">
      			  New paids: A "new paid user" is when a user makes their first non-free plan choice.<br /> <br />
      			  Upgrades: An upgrade happens when a user who is on a paid plan chooses a new plan that costs more.<br /><br />
      			  Downgrades: A downgrade happens when a user choices a new plan that is cheaper (but not free).<br /><br />
      			  Churns: Churn is any time a user downgrades from a paid plan to a free plan. <br /><br />
      			  The data comes directly from the "billing_planchoice" table in MySQL.
    			  </p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      <div class="chart plan-changes-value">
        <div class="header">
          <div class="title">$ amount of plan changes (monthly only)</div>
          <div class="help-tip">
      			<p class="tooltip">
      			  New paids: A "new paid user" is when a user makes their first non-free plan choice.<br /> <br />
      			  Upgrades: An upgrade happens when a user who is on a paid plan chooses a new plan that costs more.<br /><br />
      			  Downgrades: A downgrade happens when a user choices a new plan that is cheaper (but not free).<br /><br />
      			  Churns: Churn is any time a user downgrades from a paid plan to a free plan. <br /><br />
      			  The data comes directly from the "billing_planchoice" table in MySQL.
    			  </p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
    </div>
    <div class="charts section core" style="display: none;">
      <div class="chart report-views-total">
        <div class="header">
          <div class="title">Total report views by report type</div>
          <div class="help-tip">
      			<p class="tooltip">The number of times people are viewing each report type. This is based on the "Viewed report" event segmented by "tab"</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      <div class="chart report-views-unique">
        <div class="header">
          <div class="title">Unique report views by report type</div>
          <div class="help-tip">
      			<p class="tooltip">The number of people that are viewing each report type. This is based on the "Viewed report" event segmented by "tab"</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      <div class="chart report-median-queries">
        <div class="header">
          <div class="title">Queries per endpoint per project (90th percentile)</div>
          <div class="help-tip">
      			<p class="tooltip">For project that reprents the ninetieth precenile on each endpoint, how many queries do they make? This uses the "Mixpanel Read API" project and the "API request" event.</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
    </div>
    <div class="charts section people" style="display: none;">
      <div class="chart report-notifications-sent">
        <div class="header">
          <div class="title">Notifications sent by type</div>
          <div class="help-tip">
      			<p class="tooltip">Uses the "Mixpanel notifications" project's "notification" event</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      <div class="chart report-campaign-state">
        <div class="header">
          <div class="title">Campaign states by status</div>
          <div class="help-tip">
      			<p class="tooltip">We run a daily cron that sends an event for each campaign that represents the current state.</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      <div class="chart report-views-total">
        <div class="header">
          <div class="title">Total report views by report type</div>
          <div class="help-tip">
      			<p class="tooltip">The number of times people are viewing each report type. This is based on the "Viewed report" event segmented by "tab"</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      <div class="chart report-views-unique">
        <div class="header">
          <div class="title">Unique report views by report type</div>
          <div class="help-tip">
      			<p class="tooltip">The number of people that are viewing each report type. This is based on the "Viewed report" event segmented by "tab"</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
    </div>
    <div class="charts section systems" style="display: none;">
      <div class="chart report-track-events">
        <div class="header">
          <div class="title">Number of Track Events</div>
          <div class="help-tip">
      			<p class="tooltip">The number of track events as seen by the remap consumers. These numbers are before sampling. Higher is better. (<a target="_blank" href="https://mixpanel.com/report/29988/segmentation/#action:sum,arb_event:track_events,bool_op:and,chart_analysis_type:linear,chart_type:line,from_date:-3,segfilter:!%28%28dropdown_tab_index:0,property:%28name:count,source:properties,type:number%29,selected_property_type:number,type:number%29%29,segment_type:number,subsegment_property:%28name:project_id,source:properties,type:number%29,subsegment_type:string,to_date:0,type:general,unit:hour">source</a>)</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      <div class="chart report-people-updates">
        <div class="header">
          <div class="title">Number of People Updates</div>
          <div class="help-tip">
      			<p class="tooltip">The number of people updates as seen by the remap consumers. These numbers are before sampling. Higher is better. (<a target="_blank" href="https://mixpanel.com/report/399213/segmentation/#action:sum,arb_event:people_updates,bool_op:and,chart_analysis_type:linear,chart_type:line,from_date:-3,ms_checked:%28%29,segfilter:!%28%28dropdown_tab_index:0,property:%28name:count,source:properties,type:number%29,selected_property_type:number,type:number%29%29,segment_type:number,subsegment_property:%28name:project_id,source:properties,type:number%29,subsegment_type:string,to_date:0,type:general,unit:hour">source</a>)</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      <div class="chart report-decide-queries">
        <div class="header">
          <div class="title">Number of Decide Queries</div>
          <div class="help-tip">
      			<p class="tooltip">The number of decide queries as seen by the decide distributed query servers and the decide API. The DQS numbers are post any filtering done by the decide api servers. The API numbers are multiplied by 10000 because decide only tracks 0.01% of the requests. Higher is better. (<a target="_blank" href="https://mixpanel.com/report/486853/segmentation/#action:sum,arb_event:decide_requests,bool_op:and,chart_analysis_type:linear,chart_type:line,from_date:-3,segfilter:!%28%28dropdown_tab_index:0,property:%28name:count,source:properties,type:number%29,selected_property_type:number,type:number%29%29,segment_type:number,subsegment_property:%28name:project_id,source:properties,type:number%29,subsegment_type:string,to_date:0,type:general,unit:hour">dqs queries</a>, <a target="_blank" href="https://mixpanel.com/report/486853/segmentation/#action:segment,arb_event:request,bool_op:and,chart_analysis_type:linear,chart_type:line,from_date:-3,segfilter:!%28%28dropdown_tab_index:0,property:%28name:project_id,source:properties,type:number%29,selected_property_type:number,type:string%29%29,segment_type:string,to_date:0,type:general,unit:hour">api queries</a>).</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      <div class="chart report-decide-queries-type">
        <div class="header">
          <div class="title">Number of Notifications, Surveys and Variants sent by Decide API</div>
          <div class="help-tip">
      			<p class="tooltip">The number of notifications, variants and surveys sent by the Decide API servers. Numbers are multiplied by 1000 because the server samples at 0.1%. Higher is better. (<a target="_blank" href="https://mixpanel.com/report/486853/segmentation/#action:sum,arb_event:request,bool_op:and,chart_analysis_type:linear,chart_type:line,from_date:-3,segfilter:!%28%28dropdown_tab_index:0,property:%28name:num_notifications,source:properties,type:number%29,selected_property_type:number,type:number%29%29,segment_type:number,subsegment_property:%28name:project_id,source:properties,type:number%29,subsegment_type:string,to_date:0,type:general,unit:hour">notifications</a>, <a target="_blank" href="https://mixpanel.com/report/486853/segmentation/#action:sum,arb_event:request,bool_op:and,chart_analysis_type:linear,chart_type:line,from_date:-3,segfilter:!%28%28dropdown_tab_index:0,property:%28name:num_surveys,source:properties,type:number%29,selected_property_type:number,type:number%29%29,segment_type:number,subsegment_property:%28name:project_id,source:properties,type:number%29,subsegment_type:string,to_date:0,type:general,unit:hour">surveys</a>, <a target="_blank" href="https://mixpanel.com/report/486853/segmentation/#action:sum,arb_event:request,bool_op:and,chart_analysis_type:linear,chart_type:line,from_date:-3,segfilter:!%28%28dropdown_tab_index:0,property:%28name:num_variants,source:properties,type:number%29,selected_property_type:number,type:number%29%29,segment_type:number,subsegment_property:%28name:project_id,source:properties,type:number%29,subsegment_type:string,to_date:0,type:general,unit:hour">variants</a>).</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      <div class="chart report-read-api-dqs">
        <div class="header">
          <div class="title">Number of Errors, Timeouts and Slow Queries</div>
          <div class="help-tip">
      			<p class="tooltip">Number of errors (except bad request, blocked or rate limited), timeouts (latency more than 120 seconds) and slow queries (latency more than 5 seconds) as seen by the read api. Lower is better. (<a  target="_blank" href="https://mixpanel.com/report/620033/segmentation/#action:segment,arb_event:%27API%20request%27,bool_op:or,chart_analysis_type:linear,chart_type:line,from_date:-3,segfilter:!%28%28dropdown_tab_index:0,filter:%28operand:%27120000%27,operator:%3E%29,property:%28name:elapsed,source:properties,type:number%29,selected_property_type:number,type:number%29,%28dropdown_tab_index:0,property:%28name:%27project%20id%27,source:properties,type:number%29,selected_property_type:number,type:string%29%29,segment_type:string,to_date:-1,type:general,unit:hour">timeouts</a>, <a target="_blank" href="https://mixpanel.com/report/620033/segmentation/#action:segment,arb_event:%27API%20request%27,bool_op:or,chart_analysis_type:linear,chart_type:line,from_date:-3,segfilter:!%28%28dropdown_tab_index:0,filter:%28operand:%275000%27,operator:%3E%29,property:%28name:elapsed,source:properties,type:number%29,selected_property_type:number,type:number%29,%28dropdown_tab_index:0,property:%28name:%27project%20id%27,source:properties,type:number%29,selected_property_type:number,type:string%29%29,segment_type:string,to_date:-1,type:general,unit:hour">slow queries</a>, <a target="_blank" href="https://mixpanel.com/report/620033/segmentation/#action:segment,arb_event:%27API%20request%27,bool_op:or,chart_analysis_type:linear,chart_type:line,from_date:-3,segfilter:!%28%28dropdown_tab_index:0,filter:%28operand:!%28unknown%29,operator:%3D%3D%29,property:%28name:error,source:properties,type:string%29,selected_property_type:string,type:string%29,%28dropdown_tab_index:0,property:%28name:%27project%20id%27,source:properties,type:number%29,selected_property_type:number,type:string%29%29,segment_type:string,to_date:-1,type:general,unit:hour">errors</a>)</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
       <div class="chart report-read-api-slow-projects">
        <div class="header">
          <div class="title">Number of Slow Queries by Project</div>
          <div class="help-tip">
      			<p class="tooltip">The top projects by the number of slow queries (latency more than 5 seconds) as seen by the read api. Lower is better. (<a target="_blank" href="https://mixpanel.com/report/620033/segmentation/#action:segment,arb_event:%27API%20request%27,bool_op:or,chart_analysis_type:linear,chart_type:line,from_date:-3,segfilter:!%28%28dropdown_tab_index:0,filter:%28operand:%275000%27,operator:%3E%29,property:%28name:elapsed,source:properties,type:number%29,selected_property_type:number,type:number%29,%28dropdown_tab_index:0,property:%28name:%27project%20id%27,source:properties,type:number%29,selected_property_type:number,type:string%29%29,segment_type:string,to_date:-1,type:general,unit:hour">slow queries</a>)</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      <div class="chart report-arb-queries-origin">
        <div class="header">
          <div class="title">Number of Event Queries by query origin</div>
          <div class="help-tip">
      			<p class="tooltip">The number of queries as seen by the arb distributed query server, segmented on the query origin. Higher is better. (<a  target="_blank" href="https://mixpanel.com/report/29988/segmentation/#action:segment,arb_event:query,bool_op:and,chart_analysis_type:linear,chart_type:line,from_date:-3,ms_checked:%28api:!t,notifications:!t,undefined:!t%29,ms_values:!%28api,notifications,undefined%29,segfilter:!%28%28dropdown_tab_index:0,property:%28name:query_origin,source:properties,type:string%29,selected_property_type:string,type:string%29%29,segment_type:string,to_date:0,type:general,unit:hour">source</a>)</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      <div class="chart report-engage-queries-origin">
        <div class="header">
          <div class="title">Number of People Queries by query origin</div>
          <div class="help-tip">
      			<p class="tooltip">The number of queries as seen by the engage distributed query server, segmented on the query origin. Higher is better. (<a  target="_blank" href="https://mixpanel.com/report/399213/segmentation/#action:segment,arb_event:query,bool_op:and,chart_analysis_type:linear,chart_type:line,from_date:-3,ms_checked:%28api:!t,notifications:!t,undefined:!t%29,segfilter:!%28%28dropdown_tab_index:0,property:%28name:query_origin,source:properties,type:string%29,selected_property_type:string,type:string%29%29,segment_type:string,to_date:0,type:general,unit:hour">source</a>)</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      <div class="chart report-jql-queries">
        <div class="header">
          <div class="title">The number of JQL vs non-JQL queries</div>
          <div class="help-tip">
      			<p class="tooltip">The number of JQL vs non-JQL queries as seen by the read api. We want the number of JQL queries to increase and the number of non-JQL queries to decrease proportionately. (<a target="_blank" href="https://mixpanel.com/report/620033/segmentation/#action:segment,arb_event:%27API%20request%27,bool_op:or,chart_analysis_type:linear,chart_type:line,from_date:-3,segfilter:!%28%28dropdown_tab_index:0,filter:%28operand:jql,operator:in%29,property:%28name:endpoint,source:properties,type:string%29,selected_property_type:string,type:string%29,%28dropdown_tab_index:0,filter:%28operand:custom-query,operator:in%29,property:%28name:endpoint,source:properties,type:string%29,selected_property_type:string,type:string%29%29,to_date:-1,type:general,unit:hour">jql</a>, <a target="_blank" href="https://mixpanel.com/report/620033/segmentation/#action:segment,arb_event:%27API%20request%27,bool_op:and,chart_analysis_type:linear,chart_type:line,from_date:-3,segfilter:!%28%28dropdown_tab_index:0,filter:%28operand:jql,operator:%27not%20in%27%29,property:%28name:endpoint,source:properties,type:string%29,selected_property_type:string,type:string%29,%28dropdown_tab_index:0,filter:%28operand:custom-query,operator:%27not%20in%27%29,property:%28name:endpoint,source:properties,type:string%29,selected_property_type:string,type:string%29%29,to_date:-1,type:general,unit:hour">non jql</a>)</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
      <div class="chart report-ml">
        <div class="header">
          <div class="title">The number of ML and non ML queries</div>
          <div class="help-tip">
      			<p class="tooltip">The number of ML queries as seen by the arb local query server vs. the ones not from ML (<a target="_blank" href="https://mixpanel.com/report/29988/segmentation/#action:segment,arb_event:subquery,bool_op:and,chart_analysis_type:linear,chart_type:line,from_date:-3,segfilter:!%28%28dropdown_tab_index:0,property:%28name:query_origin,source:properties,type:string%29,selected_property_type:string,type:string%29%29,segment_type:string,to_date:0,type:general,unit:hour">source</a>)</p>
      		</div>
        </div>
        <div class="body"></div>
      </div>
    </div>
    <div class="charts section sre" style="display: none;">
      <div class="chart nigh-time-pages">
        <div class="header">
          <div class="title">Nights with night time pages</div>
            <div class="help-tip">
                <p class="tooltip">Days with pager duty alerts occured at night time (10pm - 9am)</p>
            </div>
        </div>
        <div class="body"></div>
      </div>
        <!--<div class="result" id="nightTimeEscalationsElement">
         </div>-->
        
      <div class="chart build-bot">
        <div class="header">
          <div class="title">Buildbod failre rate %</div>
            <div class="help-tip">
                <p class="tooltip">failure / (success + failure) * 100%</p>
            </div>
        </div>
        <div class="body"></div>
      </div>
    </div>
     
    <script type="text/jql" id="nightTimeEscalationsQuery">
        function timestampToDate(timestamp) {
          var result = new Date(0);
          result.setUTCSeconds(timestamp);
          return result;
        }

        nightEnd = 9;
        nightStart = 22;

        function isNight(date) {
          return date.getHours() < nightEnd  || date.getHours() >= nightStart;
        }

        function allignTimestampToMonth(timestamp) {
          function padMonth(month) {
            if (month < 10) {
              return "0" + month
            } else {
              return "" + month
            }
          }
          var date = timestampToDate(timestamp);
          return new Date(date.getUTCFullYear() + "-" + padMonth(date.getUTCMonth() + 1) + "-01T00:00:00Z");
        }

        function allignTimestampToDay(timestamp) {
          var timeGranularity = 1 * 60 * 60 * 24; //1d
          return timestampToDate(Math.floor((timestamp) / timeGranularity) * timeGranularity);
        }

        function allignTimestampToWeek(timestamp) {
          var timeShift = 4 * 60 * 60 * 24; // epoch is Thursday
          var timeGranularity = 7 * 60 * 60 * 24; //1d
          return timestampToDate(Math.floor((timestamp + timeShift) / timeGranularity) * timeGranularity + timeShift - 7 * 60 * 60 * 24);
        }

        function allignTimestamp(timestamp) {
          if (params.unit == 'day') {
            return allignTimestampToDay(timestamp);
          } else if (params.unit == 'week') {
            return allignTimestampToWeek(timestamp);
          } else if (params.unit == 'month') {
            return allignTimestampToMonth(timestamp);
          } else {
            return new Date();
          }
        }

        function allignEventTime(t) {
          if (t.event === undefined)
             return null;
             
          var timeGranularity = 60 * 60 * 24; //1d
          return timestampToDate(
            // If incident occured after nightEnd it will be accaunted to day of occurence otherwise to previous day
            Math.floor((t.event.properties.created_at / 1000 - nightEnd * 60 * 60) / timeGranularity) * timeGranularity
          );
        }

        function eventsFilter(t) {
            if (t.user === undefined || t.event === undefined)
              return false;
            if (t.user.properties.urgency != 'high')
              return false;
            if (t.event.name == "pagerduty.incident.notify" && t.event.properties.notification.type == "email")
              return false;
            if (!isNight(t.event.properties.created_at))
              return false;
            return true;
        }

        function computeEscalations(t) {
            var current = Date.parse(params.from_date) / 1000;
            var end = Date.parse(params.to_date) / 1000;
            var v = {};
            while (current <= end) {
              var currentDateKey = allignTimestamp(current).toISOString().split('T')[0];
              var currentDate = timestampToDate(current);
              if (!v.hasOwnProperty(currentDateKey)) {
                v[currentDateKey] = 0;
              }
              if (t.value.hasOwnProperty(currentDate)) {
                v[currentDateKey] += t.value[currentDate];
              }
              current += 24 * 60 * 60;
            }
            t.value = v;
            return t;
        }

        function main() {
          return join(
            Events({from_date: params.from_date, to_date: params.to_date, event_selectors: [{event: 'pagerduty.incident.notify'}]}), People()
          )
          .filter(eventsFilter)
          .groupBy(['user.properties.escalation_policy_name', allignEventTime], function(a, b) {return 1;})
          .groupBy([function(t){return t.key[0]}], function(a, b) {
            var result = {};
            for (var i in a) {
              for (var k in a[i])
                 result[k] = a[i][k];
            }
            for (i in b) {
              result[timestampToDate(Date.parse(b[i].key[1]) / 1000)] = b[i].value;
            }
            return result;
          })
          .map(computeEscalations)
          ;
        }
    </script>
    
    <script type="text/jql" id="buildBotFailureRateQuery">
        function timestampToDate(timestamp) {
          var result = new Date(0);
          result.setUTCSeconds(timestamp);
          return result;
        }

        function allignTimestampToMonth(timestamp) {
          function padMonth(month) {
            if (month < 10) {
              return "0" + month;
            } else {
              return "" + month;
            }
          }
          var date = timestampToDate(timestamp);
          return new Date(date.getUTCFullYear() + "-" + padMonth(date.getUTCMonth() + 1) + "-01T00:00:00Z");
        }

        function allignTimestampToDay(timestamp) {
          var timeGranularity = 1 * 60 * 60 * 24; //1d
          return timestampToDate(Math.floor((timestamp) / timeGranularity) * timeGranularity);
        }

        function allignTimestampToWeek(timestamp) {
          var timeShift = 4 * 60 * 60 * 24; // epoch is Thursday
          var timeGranularity = 7 * 60 * 60 * 24; //1d
          return timestampToDate(Math.floor((timestamp + timeShift) / timeGranularity) * timeGranularity + timeShift - 7 * 60 * 60 * 24);
        }

        function allignTimestamp(e) {
          var timestamp = e.time / 1000;
          if (params.unit == 'day') {
            return allignTimestampToDay(timestamp);
          } else if (params.unit == 'week') {
            return allignTimestampToWeek(timestamp);
          } else if (params.unit == 'month') {
            return allignTimestampToMonth(timestamp);
          } else {
            return new Date();
          }
        }

        function resultReducer(a, b) {
         result = {success: 0, failure: 0};
         for (var i in a) {
            result.success += a[i].success;
            result.failure += a[i].failure;
          }
          
          for (var i in b) {
            if (b[i].properties.num_failed_tests > 0) {
              result.failure += 1;
            } else {
              result.success += 1;
            }
          }
          return result;
        }

        function main() {
          return Events({event_selectors: [{event: 'Buildbot finished'}], from_date: params.from_date, to_date: params.to_date})
          .groupBy([allignTimestamp], resultReducer)
          ;
        }
    </script>
     
    <script type="text/cq" id="activeUsersQuery">
      var nowUTC = (new Date()).getTime();
      var activityWindow = 5 * 60 * 1000;
      function main() {
        return Events({from_date: params.from_date, to_date: params.to_date, event_selectors: [{event: "Viewed report"}]})
          .filter(function(event) {
            var nowProjectTime = nowUTC + (params.projectTimeOffset * 60 * 60 * 1000);
            return (event.time >= nowProjectTime - activityWindow);
          })
          .groupByUser(mixpanel.reducer.count())
          .reduce(mixpanel.reducer.count())
      }
    </script>
    
    <script type="text/cq" id="medianQueriesQuery">
      function getDay(event) {
          return (new Date(event.time)).toISOString().split("T")[0];
      }
      
      function getMonth(event) {
          var date = (new Date(event.time)).toISOString().split("T")[0];
          var parts = date.split("-");
          return parts[0] + "-" + parts[1];
      }
      
      function main() {
          return Events({from_date: params.from_date, to_date: params.to_date, event_selectors: [{event: "API request"}]})
              .groupBy(["properties.project id", getDay, "properties.endpoint"], mixpanel.reducer.count())
              .groupBy([function(obj) { return obj.key.slice(1); } ], function (accumulators, objects) {
                  // { key: [day, tab, distinct_id], value: count }
                  ret = [];
                  for (var i = 0; i < accumulators.length; ++i) {
                      ret = ret.concat(accumulators[i]);
                  }
                  for (var i = 0; i < objects.length; ++i) {
                      ret.push(objects[i].value)
                  }
                  return ret;
              })
              .map(function(obj) {
                  // obj.key: [day, tab]
                  // obj.value: [values]
                  obj.value.sort(function(a,b) { return a - b;});
                  val = obj.value;
      
                  obj.median = (val.length % 2 == 0 ? (val[val.length / 2] + val[val.length / 2- 1]) / 2 : val[Math.floor(val.length / 2)]);
                  obj.ninetieth = val[Math.floor(val.length * 9 / 10)]
                  obj.max = val[val.length - 1];
                  obj.value = undefined;
                  return {
                      date: obj.key[0],
                      tab: obj.key[1],
                      median: obj.median,
                      ninetieth: obj.ninetieth
                  }
              })
      }
    </script>
    <script>
        
    var signData = function(origData, apiKey, apiSecret) {
      apiKey = apiKey || MP.api.apiKey;
      apiSecret = apiSecret || MP.api.apiSecret;
      data = _.extend({
        api_key: apiKey,
        expire: Math.ceil((new Date().getTime()) / 1000) + 60 * 60 // 1 hour expiry
      }, origData)
      
      // sign
      var paramNames = _.keys(data).sort();
      var sigString = _.reduce(paramNames, function(memo, key) {
        if (_.isUndefined(data[key])) {
          return memo;
        }
        return memo + key + '=' + data[key];
      }, '');
      sigString += apiSecret;
      data.sig = hex_md5(sigString);
      
      return data;
    };
    
    
    
    MP.api.on('mpplatform.credentialsRegistered', function() {
      var getActiveUsers = function(projectTimeOffset) {
        var today = moment().format('YYYY-MM-DD');
        var data = {
          params: JSON.stringify({projectTimeOffset: projectTimeOffset, from_date: today, to_date: today}),
          script: $.trim($("#activeUsersQuery").html()),
        }
        
        $.post("https://mixpanel.com/api/2.0/custom_query_v1", signData(data), function(resp) {
          
          var newCount = parseInt(resp[0]);
          var oldCount = parseInt($('.active-users-count').text() || newCount - 5);
          var animationLength = 3000 // milis
          var intervals = Math.abs(newCount - oldCount);
          var intervalLength = (animationLength / intervals)
          for(var i = 1; i <= intervals; i++) {
            (function(interval, intervalLength) {
              setTimeout(function() {
                var num = newCount > oldCount ? oldCount + interval : oldCount - interval;
                $('.active-users-count').text(num);
              }, intervalLength * interval);
            })(i, intervalLength);
          }
        })
      }
      
      getWithCredentials("https://mixpanel.com/admin/internal/api/tz_offset", {tz: "America/Los_Angeles"})
        .done(getActiveUsers);
      
      // setInterval(getActiveUsers, 5000);
    });
       
    var getWithCredentials = function(url, data, success) {
      var params = {
        type: 'get',
        xhrFields: { withCredentials: true }
      }
      if (typeof(url) == "object") {
        params = _.extend(params, url);
      } else {
        params.url = url;
        params.data = data;
        params.success = success;
      }
      return $.ajax(params)
    }
    
    var sections = {
      'general': function() {
      
        var unit = $('.unit-select').val();
        var intervals = $('.intervals-input').val();
        var startDate = moment().subtract(intervals, unit);
        var endDate = moment();
        var globalParams = {
          unit: unit,
          from: startDate,
          to: endDate
        }
        
        // homepage views query
        MP.api.segment('homepage new', _.extend({type: 'unique', where: 'not "@mixpanel.com" in user["$email"]'}, globalParams))
          .done(function(results) {
            $('.chart.homepage-views .body').MPChart('setData', results);
          });
          
        // signups query
        MP.api.segment('$signup', _.extend({where: 'not "@mixpanel.com" in user["$email"]'}, globalParams))
          .done(function(results) {
            $('.chart.new-users .body').MPChart('setData', results);
          });
      
        // active users query
        MP.api.segment('Viewed report', _.extend({
          type: 'unique', 
          where: 'user["Current tally"] > 500 and not "@mixpanel.com" in user["$email"]'
        }, globalParams))
          .done(function(results) {
            $('.chart.active-users .body').MPChart('setData', results);
          });
          
        // account changes (new, upsells, downgrades, churns)
        getWithCredentials('https://mixpanel.com/admin/internal/api/plan_changes',
          {
            unit: unit,
            from: startDate.startOf('month').format('YYYY-MM-DD'),
            to: endDate.endOf('month').format('YYYY-MM-DD')
          }
        )
          .done(function(results) {
            $('.chart.plan-changes-count .body').MPChart('setData', results.counts);
            $('.chart.plan-changes-value .body').MPChart('setData', results.values);
          });
          
        // new integrations
        MP.api.query('/api/2.0/engage/analytics', {
          x_segment: 'first integration date',
          x_type: 'datetime',
          from_date: startDate.format('YYYY-MM-DD'),
          to_date: endDate.format('YYYY-MM-DD'),
          x_unit: unit,
          where: 'properties["Current tally"] > 0 and not "@mixpanel.com" in properties["$email"]'
        })
          .done(function(resp) { 
            data = {};
            _.each(resp.results, function(segmentsAndCounts, date) {
              _.each(segmentsAndCounts, function(count, seg) {
                data[seg] = data[seg] || {};
                data[seg][date] = count;
              })
            })
            $('.chart.new-integrations .body').MPChart('setData', data);
          });
          
        // real integrations
        MP.api.query('/api/2.0/engage/analytics', {
          x_segment: 'first integration date',
          x_type: 'datetime',
          from_date: startDate.format('YYYY-MM-DD'),
          to_date: endDate.format('YYYY-MM-DD'),
          x_unit: unit,
          where: 'properties["Current tally"] > 100 and not "@mixpanel.com" in properties["$email"]'
        })
          .done(function(resp) { 
            data = {};
            _.each(resp.results, function(segmentsAndCounts, date) {
              _.each(segmentsAndCounts, function(count, seg) {
                data[seg] = data[seg] || {};
                data[seg][date] = count;
              })
            })
            $('.chart.real-integrations .body').MPChart('setData', data);
          });
      },
      
      'core': function() {
        var unit = $('.unit-select').val();
        var intervals = $('.intervals-input').val();
        var startDate = moment().subtract(intervals, unit);
        var endDate = moment();
        var globalParams = {
          unit: unit,
          from: startDate,
          to: endDate
        }
        
         // total report views query
        MP.api.segment('Viewed report', _.extend({
          where: 'not "@mixpanel.com" in user["$email"] and (properties["tab"] == "ab_test" or properties["tab"] == "formulas" or properties["tab"] == "funnels" or properties["tab"] == "live" or properties["tab"] == "mpplatform" or properties["tab"] == "retention" or properties["tab"] == "query-console" or properties["tab"] == "segmentation")',
          on: 'properties["tab"]'
        }, globalParams))
          .done(function(results) {
            $('.core .chart.report-views-total .body').MPChart('setData', results);
          });
          
        // unqiue report views query
        MP.api.segment('Viewed report', _.extend({
          type: 'unique', 
          where: 'not "@mixpanel.com" in user["$email"] and (properties["tab"] == "ab_test" or properties["tab"] == "formulas" or properties["tab"] == "funnels" or properties["tab"] == "live" or properties["tab"] == "mpplatform" or properties["tab"] == "retention" or properties["tab"] == "query-console" or properties["tab"] == "segmentation")', 
          on: 'properties["tab"]'
        }, globalParams))
          .done(function(results) {
            $('.core .chart.report-views-unique .body').MPChart('setData', results);
          });
          
        // median queries
        getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 620033}).done(function(creds) {
          var from = moment().subtract(7, 'day').format('YYYY-MM-DD');
          var to = moment().format('YYYY-MM-DD');
          var data = {
            params: JSON.stringify({from_date: from, to_date: to}),
            script: $.trim($("#medianQueriesQuery").html()),
          }
          
          $.post("https://mixpanel.com/api/2.0/custom_query_v1", signData(data, creds.apiKey, creds.apiSecret), function(results) {
            var series = {};
            for(var i = 0; i < results.length; i++) {
              var tab = results[i].tab;
              series[tab] = series[tab] || {};
              series[tab][results[i].date] = results[i].ninetieth
            }
            $('.core .chart.report-median-queries .body').MPChart('setData', series);
          })
        });
      
      },
      
      'people': function() {
        var unit = $('.unit-select').val();
        var intervals = $('.intervals-input').val();
        var startDate = moment().subtract(intervals, unit);
        var endDate = moment();
        var globalParams = {
          unit: unit,
          from_date: startDate.format('YYYY-MM-DD'),
          to_date: endDate.format('YYYY-MM-DD')
        }
        
        var d1 = $.Deferred();
        var d2 = $.Deferred();
        
        // notifications sent
        getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 258190}).done(function(creds) {
          var data = _.extend(globalParams, {
            event: "notification",
            on: "properties[\"message_type\"]"
          })
          
          $.get("https://mixpanel.com/api/2.0/segmentation", signData(data, creds.apiKey, creds.apiSecret)).done(function(results) {
            d1.resolve(results);
          })
        });
        
        // in-app (web & mobile) notifications sent
        getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 350447}).done(function(creds) {
          var data = _.extend(globalParams, {
            event: "Notification Shown",
            on: "properties[\"message_type\"]"
          })
          
          $.get("https://mixpanel.com/api/2.0/segmentation", signData(data, creds.apiKey, creds.apiSecret)).done(function(results) {
            d2.resolve(results);
          })
        });
        
        $.when(d1, d2).done(function(notifs, inApp) {
          delete inApp.data.values.undefined; // from 2014... probably bad tracking
          var chartData =  Object.assign({}, notifs.data.values, inApp.data.values);
          $('.chart.report-notifications-sent .body').MPChart('setData', chartData);
        });
        
        // campaign state
        getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 876479}).done(function(creds) {
          var data = _.extend(globalParams, {
            event: "Campaign state",
            on: "properties[\"status\"]",
            type: "unique"
          })
          
          $.get("https://mixpanel.com/api/2.0/segmentation", signData(data, creds.apiKey, creds.apiSecret)).done(function(results) {
            $('.chart.report-campaign-state .body').MPChart('setData', results.data.values);
          })
        });
        
          // total report views
        MP.api.segment('Viewed report', _.extend({
          where: 'not "@mixpanel.com" in user["$email"] and (properties["tab"] == "explore" or properties["tab"] == "revenue" or properties["tab"] == "surveys" or properties["tab"] == "triggers" or properties["tab"] == "analytics")',
          on: 'properties["tab"]'
        }, globalParams))
          .done(function(results) {
            $('.people .chart.report-views-total .body').MPChart('setData', results);
          });
          
        // unqiue report views query
        MP.api.segment('Viewed report', _.extend({
          type: 'unique', 
          where: 'not "@mixpanel.com" in user["$email"] and (properties["tab"] == "explore" or properties["tab"] == "revenue" or properties["tab"] == "surveys" or properties["tab"] == "triggers" or properties["tab"] == "analytics")', 
          on: 'properties["tab"]'
        }, globalParams))
          .done(function(results) {
            $('.people .chart.report-views-unique .body').MPChart('setData', results);
          });
         
        
        
      },
      
      'systems': function() {
        var unit = $('.unit-select').val();
        var intervals = $('.intervals-input').val();
        var startDate = moment().subtract(intervals, unit);
        var endDate = moment();
        var globalParams = {
          unit: unit,
          from_date: startDate.format('YYYY-MM-DD'),
          to_date: endDate.format('YYYY-MM-DD')
        }
        
        // track events 
        getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 29988}).done(function(creds) {
          var data = _.extend({}, globalParams, {
            event: "track_events",
            on: "number(properties[\"count\"])"
          })
          
          $.get("https://mixpanel.com/api/2.0/segmentation/sum", signData(data, creds.apiKey, creds.apiSecret)).done(function(results_pre_sampling) {
             var data = _.extend({}, globalParams, {
               event: "track_events",
               on: "number(properties[\"post_sampling\"])"
             })
             $.get("https://mixpanel.com/api/2.0/segmentation/sum", signData(data, creds.apiKey, creds.apiSecret)).done(function(results_post_sampling) {
               $('.chart.report-track-events .body').MPChart('setData', {
                 "track events pre sampling": results_pre_sampling.results,
                 "track events post sampling": results_post_sampling.results
               });
             })
            
          })
        });
        
        // people updates 
        getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 399213}).done(function(creds) {
          var data = _.extend({}, globalParams, {
            event: "people_updates",
            on: "number(properties[\"count\"])"
          })
          
          $.get("https://mixpanel.com/api/2.0/segmentation/sum", signData(data, creds.apiKey, creds.apiSecret)).done(function(results_pre_sampling) {
            var data = _.extend({}, globalParams, {
              event: "people_updates",
              on: "number(properties[\"post_sampling\"])"
            })
            $.get("https://mixpanel.com/api/2.0/segmentation/sum", signData(data, creds.apiKey, creds.apiSecret)).done(function(results_post_sampling){
              $('.chart.report-people-updates .body').MPChart('setData',  {
                "people updates pre sampling": results_pre_sampling.results,
                "people updates post sampling": results_post_sampling.results
              });
            })
            
          })
        });
        
        // decide queries 
        getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 486853}).done(function(creds) {
          var data = _.extend({}, globalParams, {
            event: "decide_requests",
            on: "number(properties[\"count\"])"
            
          })
          
          $.get("https://mixpanel.com/api/2.0/segmentation/sum", signData(data, creds.apiKey, creds.apiSecret)).done(function(results) {
            var data = _.extend({}, globalParams, {
              event: "total_requests"
            })
            $.get("https://mixpanel.com/api/2.0/segmentation", signData(data, creds.apiKey, creds.apiSecret)).done(function(results_api){
              for (var key in results_api.data.values.request) {
                results_api.data.values.request[key] = results_api.data.values.request[key]*10000
              }
              $('.chart.report-decide-queries .body').MPChart('setData',  {
                "decide queries": results.results,
                "api queries": results_api.data.values.total_requests
              });

            })
          })
        });
        
        // decide notifications, surveys and variants
        getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 486853}).done(function(creds) {
          var data = _.extend({}, globalParams, {
            event: "request",
            on: "number(properties[\"num_notifications\"])"
          })
          $.get("https://mixpanel.com/api/2.0/segmentation/sum", signData(data, creds.apiKey, creds.apiSecret)).done(function(results_notifications) {
            var data = _.extend({}, globalParams, {
              event: "request",
              on: "number(properties[\"num_surveys\"])"
            })
            $.get("https://mixpanel.com/api/2.0/segmentation/sum", signData(data, creds.apiKey, creds.apiSecret)).done(function(results_surveys) {
              var data = _.extend({}, globalParams, {
                event: "request",
                on: "number(properties[\"num_variants\"])"
              })
              $.get("https://mixpanel.com/api/2.0/segmentation/sum", signData(data, creds.apiKey, creds.apiSecret)).done(function(results_variants) {
                for (var key in results_notifications.results) {
                  results_notifications.results[key] = results_notifications.results[key]*1000
                }
                for (var key in results_surveys.results) {
                  results_surveys.results[key] = results_surveys.results[key]*1000
                }
                for (var key in results_variants.results) {
                  results_variants.results[key] = results_variants.results[key]*1000
                }
                $('.chart.report-decide-queries-type .body').MPChart('setData',  {
                  "notifications": results_notifications.results,
                  "surveys": results_surveys.results,
                  "variants": results_variants.results
                });
              });
            });
          });
        });

        // jql vs non-jql queries
        getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 620033}).done(function(creds) {
          var data = _.extend({}, globalParams, {
            event: "API request",
            type: "general",
            where: "(\"jql\" in properties[\"endpoint\"]) and (defined(properties[\"endpoint\"])) or (\"custom-query\" in properties[\"endpoint\"]) and (defined(properties[\"endpoint\"]))"
          })
          
          $.get("https://mixpanel.com/api/2.0/segmentation", signData(data, creds.apiKey, creds.apiSecret)).done(function(jql) {
            var data = _.extend({}, globalParams, {
              event: "API request",
              type: "general",
              where: "(not \"jql\" in properties[\"endpoint\"]) and (not \"custom-query\" in properties[\"endpoint\"])"
            })
            $.get("https://mixpanel.com/api/2.0/segmentation", signData(data, creds.apiKey, creds.apiSecret)).done(function(not_jql) {
              $('.chart.report-jql-queries .body').MPChart('setData', {
                "jql": jql.data.values["API request"],
                "non jql": not_jql.data.values["API request"]
              });
            })
          })
        });
        
        // ml vs non-ml
        getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 29988}).done(function(creds) {
          var data = _.extend({}, globalParams, {
            event: "subquery",
            type: "general",
            where: "\"ml-\" in properties[\"query_origin\"]"
          })
          
          $.get("https://mixpanel.com/api/2.0/segmentation", signData(data, creds.apiKey, creds.apiSecret)).done(function(ml) {
            var data = _.extend({}, globalParams, {
              event: "subquery",
              type: "general",
              where: "(not \"ml-\" in properties[\"query_origin\"])"
            })
            $.get("https://mixpanel.com/api/2.0/segmentation", signData(data, creds.apiKey, creds.apiSecret)).done(function(not_ml) {
              $('.chart.report-ml .body').MPChart('setData', {
                "ml": ml.data.values["subquery"],
                "non ml": not_ml.data.values["subquery"]
              });
            })
          })
        });
        
        // arb dqs queries by origin
        getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 29988}).done(function(creds) {
          var data = _.extend({}, globalParams, {
            event: "query",
            type: "general",
            on: "properties[\"query_origin\"]"
          })
          
          $.get("https://mixpanel.com/api/2.0/segmentation", signData(data, creds.apiKey, creds.apiSecret)).done(function(results) {
            $('.chart.report-arb-queries-origin .body').MPChart('setData', results.data.values);
          })
        });
        
        // engage dqs queries by origin
        getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 399213}).done(function(creds) {
          var data = _.extend({}, globalParams, {
            event: "query",
            type: "general",
            on: "properties[\"query_origin\"]"
          })
          
          $.get("https://mixpanel.com/api/2.0/segmentation", signData(data, creds.apiKey, creds.apiSecret)).done(function(results) {
            $('.chart.report-engage-queries-origin .body').MPChart('setData', results.data.values);
          })
        });
        
        // errors, timeouts and slow queries from the api
        getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 620033}).done(function(creds) {
          var data = _.extend({}, globalParams, {
            event: "API request",
            type: "general",
            where: "properties[\"elapsed\"]>5000"
          })
          $.get("https://mixpanel.com/api/2.0/segmentation", signData(data, creds.apiKey, creds.apiSecret)).done(function(slow) {
            var data = _.extend({}, globalParams, {
              event: "API request",
              type: "general",
              where: "properties[\"elapsed\"]>120000"
            })
            $.get("https://mixpanel.com/api/2.0/segmentation", signData(data, creds.apiKey, creds.apiSecret)).done(function(timeouts) {
              var data = _.extend({}, globalParams, {
                event: "API request",
                type: "general",
                where: "properties[\"error\"] == \"unknown\""
              })
              $.get("https://mixpanel.com/api/2.0/segmentation", signData(data, creds.apiKey, creds.apiSecret)).done(function(errors) {
                $('.chart.report-read-api-dqs .body').MPChart('setData', {
                  'slow queries': slow.data.values["API request"],
                  'timeouts': timeouts.data.values["API request"],
                  'errors': errors.data.values["API request"]
                });
              })
              
            })
            
          })
        });
        
        // slow queries by project
        getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 620033}).done(function(creds) {
          var data = _.extend({}, globalParams, {
            event: "API request",
            type: "general",
            where: "properties[\"elapsed\"]>5000",
            on: "string(properties[\"project id\"])"
          })
          
          $.get("https://mixpanel.com/api/2.0/segmentation", signData(data, creds.apiKey, creds.apiSecret)).done(function(results) {
            var chart = $('.chart.report-read-api-slow-projects .body');
            chart.MPChart('setData', results.data.values);
          })
        });
      }, // End systems
      'sre': function() {
      	var unit = $('.unit-select').val();
        var intervals = $('.intervals-input').val();
        var startDate = moment().subtract(intervals, unit);
        var endDate = moment();
        var globalParams = {
          unit: unit,
          from_date: startDate.format('YYYY-MM-DD'),
          to_date: endDate.format('YYYY-MM-DD')
        }
        // Night time escalations
        // TODO: 945801 after change to allowed_projects populated
        
        //getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 620033}).done(function(creds) {
        
          //creds.apiKey, creds.apiSecret
          $.post("https://mixpanel.com/api/2.0/custom_query_v1", signData({
            params: JSON.stringify(globalParams),
            script: $.trim($("#nightTimeEscalationsQuery").html()),
          }, "03751d0a0974a16e53779cad4ad43a50", "118d82c206a3bdf64443fca0a789bcc5")).done(function(results) {
            var chart_data = {};
            for (var i in results) {
                var key = results[i].key[0];
                if (key.startsWith("Ops lead (")) {
                    if (key.endsWith(" first)")) {
                        key = key.substr(10, key.length - 17)
                    } else {
                        key = key.substr(10, key.length - 10)
                    }
                }
                chart_data[key] = results[i].value;
            }
            $('.chart.nigh-time-pages .body').MPChart('setData', chart_data);
            //$('#nightTimeEscalationsElement').jsonView(chart_data);
          })
        //});
        
        // End Night time escalations
        
        //Buildbot
        
        // TODO: 945801 after change to allowed_projects populated
        //getWithCredentials('https://mixpanel.com/admin/internal/api/project_credentials', {project_id: 620033}).done(function(creds) {
          //creds.apiKey, creds.apiSecret
          $.post("https://mixpanel.com/api/2.0/custom_query_v1", signData({
            params: JSON.stringify(globalParams),
            script: $.trim($("#buildBotFailureRateQuery").html()),
          }, "03751d0a0974a16e53779cad4ad43a50", "118d82c206a3bdf64443fca0a789bcc5")).done(function(results) {
            var chart_data = {master: {}};
            for (var i in results) {
                chart_data['master'][results[i].key[0]] = Math.floor(results[i].value.failure / (results[i].value.success + results[i].value.failure) * 10000) / 100;
            }
            $('.chart.build-bot .body').MPChart('setData', chart_data);
          })
        //});
        // End Buildbot
        
      } // End sre
    }
    
    var runQuery = function() {
      return sections[$('.nav-tabs li.active').data('section')]();
    };
    
    $(document).ready(function() {
      $('.unit-select').MPSelect({
        items: [
          {label: 'Day(s)', value: 'day'},
          {label: 'Week(s)', value: 'week'},
          {label: 'Month(s)', value: 'month'}
        ]
      })
        .val('month')
        .on('change', runQuery);
        
      $('.intervals-input').on('change', runQuery);
      
      $('.plan-changes .query-type-select').MPSelect({
        items: [
          {label: 'count', value: 'count'},
          {label: '$ amount', value: 'value'},
        ]
      })
        .on('change', runQuery);
        
      $('.charts .chart .body').MPChart({chartType: 'line'})
    
      $('.nav-tabs li').click(function(e) {
        $('.nav-tabs li').removeClass('active');
        var $tab = $(e.target).parent();
        $tab.addClass('active');
        $('.section').hide();
        $('.section.' + $tab.data('section')).show();
        if ($tab.data('section') == "systems") {
          $('.unit-select').val('day')
          $('.intervals-input').val('14')
        } else if ($tab.data('section') == "sre") {
          $('.unit-select').val('week')
          $('.intervals-input').val('16')
        }
        runQuery();
      });
      
      runQuery();
    });
    
    /*
   * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
   * Digest Algorithm, as defined in RFC 1321.
   * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009
   * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
   * Distributed under the BSD License
   * See http://pajhome.org.uk/crypt/md5 for more info.
   */
  var hexcase=0;function hex_md5(a){return rstr2hex(rstr_md5(str2rstr_utf8(a)))}function hex_hmac_md5(a,b){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(a),str2rstr_utf8(b)))}function md5_vm_test(){return hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"}function rstr_md5(a){return binl2rstr(binl_md5(rstr2binl(a),a.length*8))}function rstr_hmac_md5(c,f){var e=rstr2binl(c);if(e.length>16){e=binl_md5(e,c.length*8)}var a=Array(16),d=Array(16);for(var b=0;b<16;b++){a[b]=e[b]^909522486;d[b]=e[b]^1549556828}var g=binl_md5(a.concat(rstr2binl(f)),512+f.length*8);return binl2rstr(binl_md5(d.concat(g),512+128))}function rstr2hex(c){try{hexcase}catch(g){hexcase=0}var f=hexcase?"0123456789ABCDEF":"0123456789abcdef";var b="";var a;for(var d=0;d<c.length;d++){a=c.charCodeAt(d);b+=f.charAt((a>>>4)&15)+f.charAt(a&15)}return b}function str2rstr_utf8(c){var b="";var d=-1;var a,e;while(++d<c.length){a=c.charCodeAt(d);e=d+1<c.length?c.charCodeAt(d+1):0;if(55296<=a&&a<=56319&&56320<=e&&e<=57343){a=65536+((a&1023)<<10)+(e&1023);d++}if(a<=127){b+=String.fromCharCode(a)}else{if(a<=2047){b+=String.fromCharCode(192|((a>>>6)&31),128|(a&63))}else{if(a<=65535){b+=String.fromCharCode(224|((a>>>12)&15),128|((a>>>6)&63),128|(a&63))}else{if(a<=2097151){b+=String.fromCharCode(240|((a>>>18)&7),128|((a>>>12)&63),128|((a>>>6)&63),128|(a&63))}}}}}return b}function rstr2binl(b){var a=Array(b.length>>2);for(var c=0;c<a.length;c++){a[c]=0}for(var c=0;c<b.length*8;c+=8){a[c>>5]|=(b.charCodeAt(c/8)&255)<<(c%32)}return a}function binl2rstr(b){var a="";for(var c=0;c<b.length*32;c+=8){a+=String.fromCharCode((b[c>>5]>>>(c%32))&255)}return a}function binl_md5(p,k){p[k>>5]|=128<<((k)%32);p[(((k+64)>>>9)<<4)+14]=k;var o=1732584193;var n=-271733879;var m=-1732584194;var l=271733878;for(var g=0;g<p.length;g+=16){var j=o;var h=n;var f=m;var e=l;o=md5_ff(o,n,m,l,p[g+0],7,-680876936);l=md5_ff(l,o,n,m,p[g+1],12,-389564586);m=md5_ff(m,l,o,n,p[g+2],17,606105819);n=md5_ff(n,m,l,o,p[g+3],22,-1044525330);o=md5_ff(o,n,m,l,p[g+4],7,-176418897);l=md5_ff(l,o,n,m,p[g+5],12,1200080426);m=md5_ff(m,l,o,n,p[g+6],17,-1473231341);n=md5_ff(n,m,l,o,p[g+7],22,-45705983);o=md5_ff(o,n,m,l,p[g+8],7,1770035416);l=md5_ff(l,o,n,m,p[g+9],12,-1958414417);m=md5_ff(m,l,o,n,p[g+10],17,-42063);n=md5_ff(n,m,l,o,p[g+11],22,-1990404162);o=md5_ff(o,n,m,l,p[g+12],7,1804603682);l=md5_ff(l,o,n,m,p[g+13],12,-40341101);m=md5_ff(m,l,o,n,p[g+14],17,-1502002290);n=md5_ff(n,m,l,o,p[g+15],22,1236535329);o=md5_gg(o,n,m,l,p[g+1],5,-165796510);l=md5_gg(l,o,n,m,p[g+6],9,-1069501632);m=md5_gg(m,l,o,n,p[g+11],14,643717713);n=md5_gg(n,m,l,o,p[g+0],20,-373897302);o=md5_gg(o,n,m,l,p[g+5],5,-701558691);l=md5_gg(l,o,n,m,p[g+10],9,38016083);m=md5_gg(m,l,o,n,p[g+15],14,-660478335);n=md5_gg(n,m,l,o,p[g+4],20,-405537848);o=md5_gg(o,n,m,l,p[g+9],5,568446438);l=md5_gg(l,o,n,m,p[g+14],9,-1019803690);m=md5_gg(m,l,o,n,p[g+3],14,-187363961);n=md5_gg(n,m,l,o,p[g+8],20,1163531501);o=md5_gg(o,n,m,l,p[g+13],5,-1444681467);l=md5_gg(l,o,n,m,p[g+2],9,-51403784);m=md5_gg(m,l,o,n,p[g+7],14,1735328473);n=md5_gg(n,m,l,o,p[g+12],20,-1926607734);o=md5_hh(o,n,m,l,p[g+5],4,-378558);l=md5_hh(l,o,n,m,p[g+8],11,-2022574463);m=md5_hh(m,l,o,n,p[g+11],16,1839030562);n=md5_hh(n,m,l,o,p[g+14],23,-35309556);o=md5_hh(o,n,m,l,p[g+1],4,-1530992060);l=md5_hh(l,o,n,m,p[g+4],11,1272893353);m=md5_hh(m,l,o,n,p[g+7],16,-155497632);n=md5_hh(n,m,l,o,p[g+10],23,-1094730640);o=md5_hh(o,n,m,l,p[g+13],4,681279174);l=md5_hh(l,o,n,m,p[g+0],11,-358537222);m=md5_hh(m,l,o,n,p[g+3],16,-722521979);n=md5_hh(n,m,l,o,p[g+6],23,76029189);o=md5_hh(o,n,m,l,p[g+9],4,-640364487);l=md5_hh(l,o,n,m,p[g+12],11,-421815835);m=md5_hh(m,l,o,n,p[g+15],16,530742520);n=md5_hh(n,m,l,o,p[g+2],23,-995338651);o=md5_ii(o,n,m,l,p[g+0],6,-198630844);l=md5_ii(l,o,n,m,p[g+7],10,1126891415);m=md5_ii(m,l,o,n,p[g+14],15,-1416354905);n=md5_ii(n,m,l,o,p[g+5],21,-57434055);o=md5_ii(o,n,m,l,p[g+12],6,1700485571);l=md5_ii(l,o,n,m,p[g+3],10,-1894986606);m=md5_ii(m,l,o,n,p[g+10],15,-1051523);n=md5_ii(n,m,l,o,p[g+1],21,-2054922799);o=md5_ii(o,n,m,l,p[g+8],6,1873313359);l=md5_ii(l,o,n,m,p[g+15],10,-30611744);m=md5_ii(m,l,o,n,p[g+6],15,-1560198380);n=md5_ii(n,m,l,o,p[g+13],21,1309151649);o=md5_ii(o,n,m,l,p[g+4],6,-145523070);l=md5_ii(l,o,n,m,p[g+11],10,-1120210379);m=md5_ii(m,l,o,n,p[g+2],15,718787259);n=md5_ii(n,m,l,o,p[g+9],21,-343485551);o=safe_add(o,j);n=safe_add(n,h);m=safe_add(m,f);l=safe_add(l,e)}return Array(o,n,m,l)}function md5_cmn(h,e,d,c,g,f){return safe_add(bit_rol(safe_add(safe_add(e,h),safe_add(c,f)),g),d)}function md5_ff(g,f,k,j,e,i,h){return md5_cmn((f&k)|((~f)&j),g,f,e,i,h)}function md5_gg(g,f,k,j,e,i,h){return md5_cmn((f&j)|(k&(~j)),g,f,e,i,h)}function md5_hh(g,f,k,j,e,i,h){return md5_cmn(f^k^j,g,f,e,i,h)}function md5_ii(g,f,k,j,e,i,h){return md5_cmn(k^(f|(~j)),g,f,e,i,h)}function safe_add(a,d){var c=(a&65535)+(d&65535);var b=(a>>16)+(d>>16)+(c>>16);return(b<<16)|(c&65535)}function bit_rol(a,b){return(a<<b)|(a>>>(32-b))};
    </script>
  </body>
</html>
